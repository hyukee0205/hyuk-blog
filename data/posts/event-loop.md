### 자바스크립트의 특징

자바스크립트는 싱글 스레드 기반의 언어로, 자바스크립트 엔진은 단일 콜 스택을 갖고 있다. 이 말은 한 번에 하나의 작업만 수행할 수 있다는 의미이다.

### **자바스크립트가 멀티 스레드처럼 동시에 여러 작업을 처리할 수 있는 이유는 무엇일까?**

자바스크립트를 실행하는 환경인 브라우저나 nodejs가 담당하고 있기 때문이다. 여기서 자바스크립트 엔진과 그 실행환경을 상호 연동 시켜주는 장치가 이벤트 루프이다. 따라서, 이벤트 루프는 자바스크립트 엔진에 있지 않고 그 환경에 속한다.

자바스크립트 엔진은 크게 메모리 힙과 콜 스택으로 이루어져 있다.

- 메모리 힙: 메모리가 할당 되는 곳 (선언된 변수, 함수가 담겨져 있다.)
- 콜 스택: 코드가 실행될 경우 하나씩 스택의 형태로 쌓이는 곳

### Web API

Web API는 브라우저에서 제공하는 API로 비동기인 setTimeout, Promise 등이 있다. 콜 스택에서 실행된 비동기 함수들은 모두 Web API를 호출한다. 그리고 Web API는 콜백 함수를 Callback Queue에 넣는다.

**예제**

```jsx
console.log(1);
setTimeout(() => {
  console.log(2);
}, 0);
console.log(3);
```

위에 코드는 1 → 3 → 2로 출력된다.

비동기 코드를 만나면 Web API 영역으로 빠지고 그 콜백은 바로 콜스택에 가는 것이 아닌 큐로 이동하게 된다.

### 태스크 큐와 마이크로태스크 큐

자바스크립트의 실행 환경은 2가지 큐를 가지고 있으며 각각 스크립트 실행, 이벤트 핸들러, 콜백 함수 등의 태스크가 담기는 공간이다. 태스크가 콜백함수라면 그 종류에 따라 다른 큐에 담기며 대표적으로는 태스크 큐와 마이크로 태스크 큐가 있다.

- 태스크 큐
  - setTimeout(), setInterval(), UI 렌더링
- 마이크로태스크 큐
  - Promise, MutationObserver

### 이벤트 루프

이벤트 루프는 2개의 큐를 감시하고 있다가 콜 스택이 비게 되면 콜백함수를 꺼내와서 실행한다. 마이크로태스크 큐의 콜백함수가 우선 순위를 가지고 있기 때문에 마이크로태스크 큐의 콜백함수를 실행하고나서 태스크 큐의 콜백함수들을 실행한다. (단, UI 렌더링이 태스크 큐에 속하기 때문에 마이크로태스크 큐의 태스크가 많으면 렌더링이 지연될 수 있다.)

---

### Reference

[자바스크립트의 이벤트 루프(Event Loop)란?](https://blog.toktokhan.dev/t-767eb0fa38f3)

[Javascript Event Loop 이벤트 루프 정리](https://talkwithcode.tistory.com/89)

[What the heck is the event loop anyway? | Philip Roberts | JSConf EU](https://www.youtube.com/watch?v=8aGhZQkoFbQ&t=452s)
